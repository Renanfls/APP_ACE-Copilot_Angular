<!-- Lista de veículos para clicar -->
<div *ngIf="veiculos.length > 0" class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-12 lg:flex flex-wrap gap-4">
  <div
    *ngFor="let v of veiculos"
    class="shadow-2xl p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer"
    [ngStyle]="{ 'background-color': getBackgroundColor(v.status) }"
    (click)="openHelpDialog(v)"
    (keydown.enter)="openHelpDialog(v)"
    (keydown.space)="openHelpDialog(v); $event.preventDefault()"
    tabindex="0"
    role="button"
    [attr.aria-label]="'Mostrar detalhes do veículo ' + v.id"
  >
    <h3 class="text-black font-bold mb-1 text-2xl">{{ v.id }}</h3>
    <div class="p-1.5 rounded-xl w-full flex justify-center gap-1" style="background-color: #141416">
      <span
        *ngFor="let a of v.atributos; let i = index"
        class="w-7 h-7 rounded-full flex items-center justify-center"
        [ngStyle]="{ 'background-color': a.cor }"
      >
        <img [src]="a.icone" [alt]="getAttributeName(i)" />
      </span>
    </div>
  </div>
</div>

<!-- Modal para exibir apenas o veículo selecionado -->
<div
  *ngIf="isHelpDialogOpen && selectedVehicle"
  class="fixed inset-0 z-50 p-4 flex items-center justify-center bg-black bg-opacity-50"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
>
  <div
    class="rounded-3xl shadow-lg w-max max-w-[90vw] h-max 2xl:max-w-[75vw] 2xl:max-h-[50vh] overflow-y-auto animate-fade-in relative"
    style="background-color: #141416"
  >
    <div class="absolute right-6 top-6 2xl:top-12 2xl:right-12">
      <button
        id="modal-close-button"
        (click)="closeHelpDialog()"
        (keydown.enter)="closeHelpDialog()"
        class="text-lg xl:text-4xl font-semibold text-gray-500 hover:text-amber-400"
        aria-label="Fechar modal"
      >
        ✕
      </button>
    </div>

    <!-- Conteúdo do veículo selecionado -->
    <div class="rounded-2xl flex flex-col-reverse lg:flex-row justify-center w-max 2xl:max-w-[100vw] h-max 2xl:max-h-[100vh]">
      <div>
        <!-- Atributos com edição de cor -->
        <div
          class="grid grid-cols-3 lg:grid-cols-1 lg:flex lg: flex-col rounded-3xl gap-3 w-full h-max 2xl:max-h-[100vh] p-6 2xl:p-24"
          style="background-color: #242427"
        >
          <div
            *ngFor="let a of selectedVehicle.atributos; let j = index"
            class="flex flex-col lg:flex-row justify-between gap-3 2xl:gap-8 p-2 rounded-lg"
          >
            <!-- Visualização do atributo -->
            <div class="flex items-center gap-3 xl:gap-8">
              <span
                class="w-8 h-8 lg:w-14 lg:h-14 2xl:w-24 2xl:h-24 rounded-full flex items-center justify-center"
                [ngStyle]="{ 'background-color': a.cor }"
              >
                <img
                  [src]="a.icone"
                  [alt]="getAttributeName(j)"
                  class="w-4 h-4 lg:w-7 lg:h-7 2xl:w-12 2xl:h-12"
                />
              </span>
              <div class="flex flex-col">
                <span class="text-white text-sm 2xl:text-3xl lg:text-nowrap font-bold">{{
                  getAttributeName(j)
                }}</span>
                <span class="text-amber-500 2xl:text-4xl font-bold">0</span>
              </div>
            </div>

            <!-- Seletor de cor com select -->
            <div class="flex items-center gap-2 pb-2">
              <select
                [(ngModel)]="selectedVehicle.atributos[j].cor"
                (change)="updateAttributeColor(j, $event)"
                class="text-white px-2 2xl:px-4 py-1 2xl:py-3 rounded cursor-pointer text-sm 2xl:text-3xl"
                style="background-color: #141416"
                [attr.aria-label]="'Selecionar cor do ' + getAttributeName(j)"
              >
                <option
                  *ngFor="let colorOption of getColorOptions()"
                  [value]="colorOption.value"
                  class="xl:text-sm 2xl:text-3xl"
                >
                  {{ colorOption.label }}
                </option>
              </select>
            </div>
          </div>
        </div>

        <!-- Informações adicionais do veículo -->
      </div>
      <div class="p-8 2xl:p-20 flex flex-col justify-between w-full 2xl:max-w-[100vw] 2xl:max-h-[100vh]">
        <div class="lg:pt-12 lg:pe-20">
          <div class="flex gap-6 mb-4">
            <p class="text-amber-400 text-md lg:text-lg 2xl:text-4xl font-bold">
              KM: <span class="text-white">6.431,4</span>
            </p>
            <p class="text-amber-400 text-md lg:text-lg 2xl:text-4xl font-bold">
              Litros: <span class="text-white">3.061,9</span>
            </p>
            <p class="text-amber-400 text-md lg:text-lg 2xl:text-4xl font-bold flex gap-1">
              KM/L:
              <span class="text-white flex gap-1"
                >2,10 <img src="assets/trending_up.svg" class="2xl:w-10" alt="seta verde cima"
              /></span>
            </p>
          </div>
          <h3 class="font-bold text-2xl lg:text-4xl 2xl:text-7xl text-amber-400">
            {{ selectedVehicle.id }} (E:51556)
          </h3>
          <div class="flex gap-6 text-sm 2xl:text-4xl font-bold">
            <span>Euro 5</span>
            <span>1721</span>
          </div>
        </div>
        <div>
          <div class="w-full text-gray-300">
            <div class="flex justify-between py-2 border-b border-gray-700 2xl:text-4xl">
              <span>Status:</span>
              <span
                [ngClass]="{
                  'text-green-400': selectedVehicle.status === 'OK',
                  'text-orange-400': selectedVehicle.status === 'Oficina',
                  'text-red-400': selectedVehicle.status === 'Sem Comunicar',
                  'text-gray-400': selectedVehicle.status === 'Inativo'
                }"
                >{{ selectedVehicle.status }}</span
              >
            </div>

            <div
              *ngIf="selectedVehicle.placa"
              class="flex justify-between py-2 border-b border-gray-700"
            >
              <span>Placa:</span>
              <span>{{ selectedVehicle.placa }}</span>
            </div>

            <div
              *ngIf="selectedVehicle.modelo"
              class="flex justify-between py-2 border-b border-gray-700"
            >
              <span>Modelo:</span>
              <span>{{ selectedVehicle.modelo }}</span>
            </div>
          </div>

          <!-- Botões de ação -->
          <div class="flex justify-end gap-3 mt-4 w-full">
            <button
              (click)="cancelChanges()"
              class="px-4 xl:px-8 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition 2xl:text-3xl"
              aria-label="Cancelar alterações"
            >
              Cancelar
            </button>
            <button
              (click)="saveChanges()"
              class="px-4 2xl:px-8 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition 2xl:text-3xl"
              aria-label="Salvar alterações"
            >
              Salvar
            </button>
            <button
              class="px-4 2xl:px-8 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition 2xl:text-3xl"
              style="background-color: #242427;"
            >
              <img src="assets/bar_chart.svg" class="2xl:w-10" alt="gráfico">
            </button>
            <button
              class="px-4 2xl:px-8 py-2 2xl:py-4 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition 2xl:text-3xl"
              style="background-color: #242427;"
            >
              <img src="assets/chat.svg" class="2xl:w-10" alt="chat">
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
